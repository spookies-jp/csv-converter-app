(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[516],{1401:e=>{e.exports={container:"Home_container__d256j",main:"Home_main__VkIEL",footer:"Home_footer__yFiaX",title:"Home_title__hYX6j",description:"Home_description__uXNdx",card:"Home_card__E5spL",uploadContainer:"Home_uploadContainer__fvHj1",uploadButton:"Home_uploadButton__wPWeA",fileInput:"Home_fileInput__m8A_b",fileName:"Home_fileName__mufoT",loading:"Home_loading__Z_JGo",loadingSpinner:"Home_loadingSpinner__XoUQF",spin:"Home_spin__VEV0f",error:"Home_error__514Ji",results:"Home_results__lDLyn",fadeIn:"Home_fadeIn__6AUDn",fileList:"Home_fileList__DdcvS",fileItem:"Home_fileItem__xJOhV",fileHeader:"Home_fileHeader__5_1b0",fileInfo:"Home_fileInfo__0i46t",encoding:"Home_encoding__vb_s_",alreadyUtf8:"Home_alreadyUtf8__w8lS2",removeButton:"Home_removeButton__rEUbQ",downloadButton:"Home_downloadButton__GHDC0",downloadButtonUtf8:"Home_downloadButtonUtf8__c5Rg2",actionBar:"Home_actionBar__tWRGD",clearAllButton:"Home_clearAllButton__sZ_f4",replacementStats:"Home_replacementStats__HW3Pk",replacementDetails:"Home_replacementDetails__DgQLf",replacementDetail:"Home_replacementDetail__aUcxG"}},6403:()=>{},9068:(e,n,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/sort",function(){return t(9417)}])},9417:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>g});var l=t(7876),i=t(4232),r=t(7328),s=t.n(r),o=t(1401),a=t.n(o),c=t(5023),d=t(9275),u=t.n(d),_=t(8220);let m=[{key:"questionId",regex:/^質問ID(\d+)$/},{key:"questionTitle",regex:/^質問タイトル(\d+)$/},{key:"answerId",regex:/^回答ID(\d+)$/},{key:"answer",regex:/^回答(\d+)$/}],f=e=>{if(!e)return e;try{let n=e.startsWith("\uFEFF"),t=e.includes("\r\n")?"\r\n":"\n",l=/(\r\n|\r|\n)$/.test(e.replace(/^\uFEFF/,"")),i=n?e.slice(1):e,r=h(i);if(0===r.length)return e;let s=r[0],o=new Map,a=[],c=[];if(s.forEach((e,n)=>{let t=e.trim(),l=!1;for(let e of m){let i=t.match(e.regex);if(!i)continue;let[,r]=i;o.has(r)||o.set(r,{questionId:null,questionTitle:null,answerId:null,answer:null}),o.get(r)[e.key]=n,"questionId"===e.key&&a.push({number:r,index:n}),l=!0;break}l||c.push(n)}),0===o.size)return e;let d=[s];for(let e=1;e<r.length;e++){let n=r[e],t=Array(s.length).fill("");c.forEach(e=>{t[e]=n[e]||""});let l=[];o.forEach(e=>{let t=n[e.questionId]||"";t&&l.push({questionIdValue:t,questionId:n[e.questionId]||"",questionTitle:n[e.questionTitle]||"",answerId:n[e.answerId]||"",answer:n[e.answer]||""})}),l.sort((e,n)=>{let t=parseInt(e.questionIdValue,10),l=parseInt(n.questionIdValue,10);return t-l}),a.sort((e,n)=>parseInt(e.number,10)-parseInt(n.number,10)),l.forEach((e,n)=>{if(n<a.length){let l=a[n].number,i=o.get(l);null!==i.questionId&&(t[i.questionId]=e.questionId),null!==i.questionTitle&&(t[i.questionTitle]=e.questionTitle),null!==i.answerId&&(t[i.answerId]=e.answerId),null!==i.answer&&(t[i.answer]=e.answer)}}),d.push(t)}let u=p(d,t,l);return n?"\uFEFF".concat(u):u}catch(n){return console.error("Failed to reorder question group columns:",n),e}},h=e=>{let n=[],t=[],l="",i=!1;for(let r=0;r<e.length;r+=1){let s=e[r];if(i){'"'===s?'"'===e[r+1]?(l+='"',r+=1):i=!1:l+=s;continue}if('"'===s){i=!0;continue}if(","===s){t.push(l),l="";continue}if("\r"===s||"\n"===s){t.push(l),n.push(t),t=[],l="","\r"===s&&"\n"===e[r+1]&&(r+=1);continue}l+=s}if(t.push(l),n.push(t),n.length>1){let t=n[n.length-1],l=1===t.length&&""===t[0],i=e.endsWith("\n")||e.endsWith("\r");l&&i&&n.pop()}return n},p=(e,n,t)=>{let l=e.map(e=>e.map(e=>{let n=null!=e?e:"",t=/[",\r\n]/.test(n),l=n.replace(/"/g,'""');return t?'"'.concat(l,'"'):l}).join(",")).join(n);return t?"".concat(l).concat(n):l};function g(){let[e,n]=(0,i.useState)([]),[t,r]=(0,i.useState)(!1),[o,d]=(0,i.useState)(""),m=(0,i.useRef)(null),h=async e=>{let t=Array.from(e.target.files);if(0===t.length)return;let l=t.filter(e=>e.name.endsWith(".csv"));if(0===l.length)return void d("CSVファイルのみアップロードできます");r(!0),d("");try{let e=[];for(let n of l){var i;let t=await n.arrayBuffer(),l=_.Buffer.from(t),r=c.detect(l),s=(null==r||null==(i=r.encoding)?void 0:i.toLowerCase())||"",o=/^[\x00-\x7F]*$/.test(l.toString("binary"));if((!s||r.confidence<.2||o)&&(s="shift_jis"),!["utf-8","ascii","shift_jis","windows-1252"].includes(s))throw Error("".concat(n.name," は未対応の文字コードです（推定: ").concat(s,"）"));let a="utf-8"===s||"ascii"===s,d=u().decode(l,s),m="\uFEFF"+d;e.push({originalName:n.name,content:m,originalEncoding:s,isAlreadyUtf8:a})}n(n=>[...n,...e]),m.current&&(m.current.value="")}catch(e){console.error("Error converting files:",e),d("ファイルの変換中にエラーが発生しました: "+e.message)}finally{r(!1)}},p=e=>{n(n=>{let t=[...n];return t.splice(e,1),t})},g=(e,n)=>{if(!e)return;let t=new Blob([f(e)],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(t),i=document.createElement("a");i.href=l,i.setAttribute("download","sorted-".concat(n||"converted.csv")),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)};return(0,l.jsxs)("div",{className:a().container,children:[(0,l.jsxs)(s(),{children:[(0,l.jsx)("title",{children:"CSV質問グループ並び替えアプリ"}),(0,l.jsx)("meta",{name:"description",content:"CSVファイルの質問・回答を正しい順序に並び替えるアプリ"}),(0,l.jsx)("link",{rel:"icon",href:"/favicon.ico"}),(0,l.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),(0,l.jsxs)("main",{className:a().main,children:[(0,l.jsx)("h1",{className:a().title,children:"CSV質問グループ並び替えアプリ"}),(0,l.jsx)("p",{className:a().description,children:"CSVファイルの質問・回答を正しい順序に並び替えます"}),(0,l.jsxs)("div",{className:a().card,children:[(0,l.jsxs)("div",{className:a().uploadContainer,children:[(0,l.jsxs)("label",{htmlFor:"csvFile",className:a().uploadButton,children:["CSVファイルを追加",(0,l.jsx)("input",{type:"file",id:"csvFile",accept:".csv",onChange:h,className:a().fileInput,multiple:!0,ref:m})]}),e.length>0&&(0,l.jsxs)("span",{className:a().fileName,children:[e.length," ファイル"]})]}),t&&(0,l.jsx)("div",{className:a().loading,children:"処理中..."}),o&&(0,l.jsx)("div",{className:a().error,children:o}),e.length>0&&(0,l.jsxs)("div",{className:a().results,children:[(0,l.jsx)("h3",{children:"変換済みファイル"}),(0,l.jsx)("div",{className:a().fileList,children:e.map((e,n)=>(0,l.jsxs)("div",{className:a().fileItem,children:[(0,l.jsxs)("div",{className:a().fileHeader,children:[(0,l.jsxs)("div",{className:a().fileInfo,children:[(0,l.jsx)("span",{className:a().fileName,children:e.originalName}),(0,l.jsx)("span",{className:a().encoding,children:e.isAlreadyUtf8?"既にUTF-8形式":"元の文字コード: ".concat(e.originalEncoding)})]}),(0,l.jsx)("button",{onClick:()=>p(n),className:a().removeButton,children:"\xd7"})]}),(0,l.jsx)("button",{onClick:()=>g(e.content,e.originalName),className:a().downloadButton,children:"並び替えてダウンロード"})]},n))}),(0,l.jsx)("div",{className:a().actionBar,children:(0,l.jsx)("button",{onClick:()=>n([]),className:a().clearAllButton,children:"全てのファイルを削除"})})]})]})]}),(0,l.jsx)("footer",{className:a().footer,children:(0,l.jsxs)("p",{children:["CSV質問グループ並び替えアプリ \xa9 ",new Date().getFullYear()]})})]})}}},e=>{var n=n=>e(e.s=n);e.O(0,[252,636,593,792],()=>n(9068)),_N_E=e.O()}]);